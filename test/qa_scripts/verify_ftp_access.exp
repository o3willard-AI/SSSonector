#!/usr/bin/expect -f

set timeout 30
set password "101abn"

# Function to test FTP access
proc test_ftp_access {from_host to_host} {
    global password
    
    puts "\n=== Testing FTP from $from_host to $to_host ==="
    spawn ssh sblanken@$from_host "echo === TESTING FTP CONNECTION === && \
        echo 'open $to_host\nuser sblanken $password\nls DryFire_v4_10.zip\nquit' | ftp -n && \
        echo === CHECKING FILE SIZE === && \
        stat -f '%z bytes' /home/sblanken/DryFire_v4_10.zip"

    expect {
        "password:" {
            send "$password\r"
            exp_continue
        }
        "Login failed" {
            puts "\n❌ FTP login failed"
            exit 1
        }
        timeout {
            puts "\n❌ Operation timed out"
            exit 1
        }
        eof {
            puts "\n✅ Test complete"
        }
    }
}

# Test FTP access in both directions
test_ftp_access "192.168.50.210" "192.168.50.211"
test_ftp_access "192.168.50.211" "192.168.50.210"
