#!/usr/bin/expect -f

# Set timeout
set timeout 300

# Get password from first argument
set password [lindex $argv 0]

# SSH into QA monitor
spawn ssh 192.168.50.212

# Handle the password prompt
expect {
    "password:" {
        send "$password\r"
    }
    timeout {
        puts "Timeout while waiting for password prompt"
        exit 1
    }
}

# Wait for prompt
expect "$ "

# Install prerequisites
send "sudo apt-get update\r"
expect "password"
send "$password\r"
expect "$ "

send "sudo apt-get install -y build-essential git golang-go\r"
expect "$ "

# Clone and build SSSonector
send "cd /tmp\r"
expect "$ "
send "git clone https://github.com/o3willard-AI/SSSonector.git\r"
expect "$ "
send "cd SSSonector\r"
expect "$ "
send "make build\r"
expect "$ "

# Install the binary
send "sudo make install\r"
expect "password"
send "$password\r"
expect "$ "

# Verify installation
send "which sssonector-control\r"
expect "$ "

# Exit
send "exit\r"
expect eof
